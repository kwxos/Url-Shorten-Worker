<!DOCTYPE html>
<html>

<head>
    <title>Url-Shorten-Worker</title>
    <meta http-equiv="Refresh" content="1; url={__FINAL_LINK__}" />
</head>

<body>
    <p>Redirecting..<br /><a href="{__FINAL_LINK__}">{__FINAL_LINK__}</a></p>
    <script type="text/javascript">
        /* <![CDATA[ */
        // 获取所有的链接元素
        var links = document.getElementsByTagName('a');

        // 遍历每个链接
        for (var i = 0; i < links.length; i++) {
            // 添加点击事件监听器
            links[i].addEventListener('click', function(event) {
                // 取得当前链接的href属性值
                var href = this.getAttribute('href');
                // 判断是否为空
                if (href !== null) {
                    // 阻止默认行为
                    event.preventDefault();
                    // 添加referer头部并重定向
                    var xhr = new XMLHttpRequest();
                    xhr.open('GET', href, true);
                    xhr.setRequestHeader('Referer', 'https://www.bilibili.com/video/');
                    xhr.onreadystatechange = function() {
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            window.location.href = href;
                        }
                    };
                    xhr.send();
                }
            });
        }
        /* ]]> */
    </script>
</body>

</html>
